<?xml version="1.0"?>
<macros>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="0.4_1">r-snow</requirement>
            <requirement type="package" version="1.26.0">bioconductor-camera</requirement>
            <requirement type="package" version="2.26.0">bioconductor-multtest</requirement>
            <requirement type="package" version="1.1_4">r-batch</requirement>
            <requirement type="package" version="1.3.23">graphicsmagick</requirement>
        </requirements>
    </xml>
    <xml name="stdio">
        <stdio>
            <exit_code range="1" level="fatal" />
        </stdio>
    </xml>

    <token name="@COMMAND_CAMERA_SCRIPT@">
        LANG=C Rscript $__tool_directory__/CAMERA.r
    </token>

    <!-- raw file load for planemo test -->
    <token name="@COMMAND_FILE_LOAD@">
        #if $file_load_section.file_load_conditional.file_load_select == "yes":
            #if $file_load_section.file_load_conditional.input[0].is_of_type("mzxml") or $file_load_section.file_load_conditional.input[0].is_of_type("mzml") or $file_load_section.file_load_conditional.input[0].is_of_type("mzdata") or $file_load_section.file_load_conditional.input[0].is_of_type("netcdf"):
                #set singlefile_galaxyPath = ','.join( [ str( $single_file ) for $single_file in $file_load_section.file_load_conditional.input ] )
                #set singlefile_sampleName = ','.join( [ str( $single_file.name ) for $single_file in $file_load_section.file_load_conditional.input ] )
                singlefile_galaxyPath '$singlefile_galaxyPath' singlefile_sampleName '$singlefile_sampleName'
            #else
                zipfile '$file_load_section.file_load_conditional.input'
            #end if
        #end if
    </token>

    <xml name="input_file_load">
        <section name="file_load_section" title="Resubmit your raw dataset or your zip file">
            <conditional name="file_load_conditional">
                <param name="file_load_select" type="select" label="Resubmit your dataset or your zip file" help="Use only if you get a message which say that your original dataset or zip file have been deleted on the server." >
                    <option value="no" >no need</option>
                    <option value="yes" >yes</option>
                </param>
                <when value="no">
                </when>
                <when value="yes">
                    <param name="input" type="data" format="mzxml,mzml,mzdata,netcdf,no_unzip.zip,zip" multiple="true" label="File(s) from your history containing your chromatograms" help="Single file mode for the format: mzxml, mzml, mzdata and netcdf. Zip file mode for the format: no_unzip.zip, zip. See the help section below." />
                </when>
            </conditional>
        </section>
    </xml>

    <xml name="test_file_load_zip">
        <section name="file_load_section">
            <conditional name="file_load_conditional">
                <param name="file_load_select" value="yes" />
                <param name="input" value="faahKO_reduce.zip" ftype="zip" />
            </conditional>
        </section>
    </xml>

    <xml name="test_file_load_single">
        <section name="file_load_section">
            <conditional name="file_load_conditional">
                <param name="file_load_select" value="yes" />
                <param name="input" value="wt15.CDF,ko16.CDF,ko15.CDF,wt16.CDF" ftype="netcdf" />
            </conditional>
        </section>
    </xml>

    <!-- peaklist export option management -->
    <token name="@COMMAND_PEAKLIST@">
        convertRTMinute $export.convertRTMinute
        numDigitsMZ $export.numDigitsMZ
        numDigitsRT $export.numDigitsRT
        intval $export.intval
    </token>

    <xml name="input_peaklist">
        <section name="export" title="Export options">
            <param name="convertRTMinute" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Convert retention time (seconds) into minutes" help="Convert the columns rtmed, rtmin and rtmax into minutes"/>
            <param name="numDigitsMZ" type="integer" value="4" label="Number of decimal places for mass values reported in ions' identifiers." help="A minimum of 4 decimal places is recommended. Useful to avoid duplicates within identifiers" />
            <param name="numDigitsRT" type="integer" value="0" label="Number of decimal places for retention time values reported in ions' identifiers." help="Useful to avoid duplicates within identifiers" />
            <param name="intval" type="select" label="General used intensity value" help="[intval] See the help section below">
                <option value="into" selected="true">into</option>
                <option value="maxo" >maxo</option>
                <option value="intb">intb</option>
            </param>
        </section>
    </xml>

    <xml name="test_peaklist">
        <section name="export">
            <param name="convertRTMinute" value="True"/>
            <param name="numDigitsMZ" value="4" />
            <param name="numDigitsRT" value="1" />
            <param name="intval" value="into"/>
        </section>
    </xml>

    <!-- annotate_diffreport <test> commun part -->
    <xml name="test_annotate_diffreport">
        <section name="groupfwhm">
            <param name="sigma" value="6"/>
            <param name="perfwhm" value="0.6"/>
        </section>
        <section name="findisotopes">
            <param name="maxcharge" value="3"/>
            <param name="maxiso" value="4"/>
            <param name="minfrac" value="0.5"/>
        </section>
        <section name="findgeneral">
            <param name="ppm" value="5"/>
            <param name="mzabs" value="0.015"/>
            <param name="max_peaks" value="100"/>
        </section>
        <section name="diffreport">
        <conditional name="options">
            <param name="option" value="show"/>
            <param name="eicmax" value="200"/>
            <param name="eicwidth" value="200"/>
            <param name="value" value="into"/>
            <param name="h" value="480"/>
            <param name="w" value="640"/>
            <param name="mzdec" value="2"/>
            <param name="sortpval" value="False"/>
        </conditional>
        </section>
        <expand macro="test_peaklist"/>
    </xml>

    <xml name="test_annotate_quick_false">
        <param name="quick" value="FALSE"/>
        <section name="groupcorr">
            <param name="cor_eic_th" value="0.75"/>
            <param name="graphMethod" value="hcs"/>
            <param name="pval" value="0.05"/>
            <param name="calcCiS" value="True"/>
            <param name="calcIso" value="False"/>
            <param name="calcCaS" value="False"/>
        </section>
    </xml>

    <xml name="test_annotate_quick_true">
        <conditional name="quick_block">
            <param name="quick" value="TRUE"/>
        </conditional>
    </xml>

    <token name="@HELP_AUTHORS@">
.. class:: infomark

**Authors**  Colin A. Smith csmith@scripps.edu, Ralf Tautenhahn rtautenh@gmail.com, Steffen Neumann sneumann@ipb-halle.de, Paul Benton hpaul.benton08@imperial.ac.uk and Christopher Conley cjconley@ucdavis.edu

.. class:: infomark

**Galaxy integration** ABiMS TEAM - UPMC/CNRS - Station biologique de Roscoff and Yann Guitton yann.guitton@oniris-nantes.fr - part of Workflow4Metabolomics.org [W4M]

 | Contact support@workflow4metabolomics.org for any questions or concerns about the Galaxy implementation of this tool.

---------------------------------------------------

    </token>


    <xml name="citation">
        <citations>
            <citation type="doi">10.1021/ac202450g</citation>
            <citation type="doi">10.1093/bioinformatics/btu813</citation>
        </citations>
    </xml>
</macros>
